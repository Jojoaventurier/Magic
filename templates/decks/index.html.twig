{% extends 'base.html.twig' %}

{% block title %}Liste des decks{% endblock %}

{% block body %}

<div class="light-white">

    <h1 class="flex justify-center gradient-adapt text-white text-2xl px-6 py-10 mb-6"><span class="border border-white rounded px-6 py-4">Tous les decks</span></h1>


    <div class="max-w-10/12 px-40 py-10">
        <div class="flex justify-evenly items-center ml-8 mr-12">
                <div class="flex flex-row ml-8 space-x-4">
                    <a href="{{ path('app_decks', {'param': 'all'}) }}" class="border-2 inline-flex justify-center px-2 py-2 rounded-lg  text-black font-semibold bg-white  hover:bg-red-900 hover:text-white transition duration-300 ease-in-out">Tous les decks</a>
                    {% if app.user %}
                    <a href="{{ path('app_decks', {'param': 'myDecks'}) }}" class="border-2 inline-flex justify-center px-2 py-2 rounded-lg  text-black font-semibold bg-white  hover:bg-red-900 hover:text-white transition duration-300 ease-in-out">Mes decks</a>
                    <a href="{{ path('app_decks', {'param': 'decksLiked'}) }}" class="border-2 inline-flex justify-center px-2 py-2 rounded-lg  text-black font-semibold bg-white  hover:bg-red-900 hover:text-white transition duration-300 ease-in-out">
                        Decks favoris
                        <img class="h-4 mt-1 w-auto ml-2" src="https://img.icons8.com/material-rounded/24/like--v1.png" alt="like--v1"/>
                    </a>
                    {% endif %}
                </div>

                <div id="center" class="">
                    <div class="inline-flex text-sm space-x-2 space-y-2">
                        <select class="text-sm" name="format" id="format">Format
                            <option value="Commander">Commander</option>
                            <option value="Standard">Standard</option>
                            <option value="Legacy">Legacy</option>
                        </select>
                        <span>Red</span>
                        <span>White</span>
                        <span>Green</span>
                        <span>Black</span>
                        <span>Blue</span>
                        <input id="deck-search-bar" class="w-full px-4 py-2 border rounded-lg focus:outline focus:outline-red-800" placeholder="Filtrer par nom de deck" type="text" onkeyup="filterUsers()">
                    </div>
                    {# <button class="flex-end text-sm underline">Plus de filtres</button> #}
                </div>
        </div>

        <div class="flex flex-wrap justify-center max-w-10/12 py-12">

            {% for deck in decks %}

            <div class="deck-card mx-2 mb-8 py-2 px-4 w-full sm:w-64 md:w-64 lg:w-64 border-spacing-2 space-y-4 border bg-white rounded-lg transform transition duration-300 hover:scale-105">
                <input class="deck-name" type="hidden" value="{{deck.deckName}}" >
                <span class="ml-2 pr-2 pb-1 text-xs italic flex justify-end">
                {% if deck.updateDate is same as null %}
                créé le {{ deck.creationDate|date('d.m.Y à H:i')}}
                {% else %}
                dernière m-a-j le {{ deck.updateDate|date('d.m.Y à H:i') }}
                {% endif %}
                </span>

                {% if deck.commander is not null %}
                    <a href="{{ path('app_deck_builder', {'id': deck.id, 'state': 'Mainboard'}) }}"> 
                        <div class="flex justify-center border px-2 py-2 w-full">
                            <img class="h-36 object-cover" src="{{ deck.commander.image_uris.art_crop }}">
                        </div>
                    </a>
                {% else %}
                    {% if deck.format.formatName is same as "Legacy" %}
                    <a href="{{ path('app_deck_builder', {'id': deck.id, 'state': 'Mainboard'}) }}">
                        <div class="flex justify-center border px-2 py-2 w-full">
                            <img class="h-36 object-cover" src='{{ asset('img/placeholder-legacy.png')}}'>
                        </div>
                    </a>
                    {% endif %}
                    {% if deck.format.formatName is same as "Standard" %}
                        <a href="{{ path('app_deck_builder', {'id': deck.id, 'state': 'Mainboard'}) }}">
                            <div class="flex justify-center border px-2 py-2 w-full">
                                <img class="h-36 object-cover" src='{{ asset('img/placeholder-standard.png')}}'>
                            </div>
                        </a>
                    {% endif %}
                    {% if deck.format.formatName is same as "Commander / EDH" %}
                        <a href="{{ path('app_deck_builder', {'id': deck.id, 'state': 'Mainboard'}) }}">
                            <div class="flex justify-center border px-2 py-2 w-full">
                                <img class="h-36 object-cover" src='{{ asset('img/placeholder-edh.png')}}'>
                            </div>
                        </a>
                    {% endif %}
                {% endif %}

                <div class="flex flex-col m-4 h-auto justify-end">
                    <a class="inline-flex w-prose" href="{{ path('app_deck_builder', {'id': deck.id, 'state': 'Mainboard'}) }}"> 
                        <h3 class="bold">{{ deck.deckName }}</h3>
                    </a>
                    <span class="text-gray-500">
                        {{ deck.format.formatName }}
                    </span> 
                    <span class="text-xs text-gray-500 ">
                        par <span class="font-semibold hover:underline hover:text-red-800"><a href="{{ path('app_profile', {'user': deck.user.username}) }}">{{ deck.user.userName }}</a></span>
                    </span>


                    <div class="inline-flex justify-end space-x-2 mt-3">
                        <span class="flex text-sm mt-1">
                            <img class="h-4 mt-1 w-auto" src="https://img.icons8.com/material-outlined/24/comments--v1.png" alt="like--v1"/>
                            {{ deck.comments|length }}</span> 
                        </span>
                        <span class="flex text-sm mt-1">
                            <img class="h-4 mt-1 w-auto" src="https://img.icons8.com/material-outlined/24/like--v1.png" alt="like--v1"/>
                            {{ deck.likes|length }}</span> 
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>



{% block javascripts %} 

<script>
    function filterUsers() {
        // Get the search query
        var query = document.getElementById('deck-search-bar').value.toLowerCase();
        // Get all the user forms
        var cards = document.querySelectorAll('.deck-card');
        
        cards.forEach(function(card) {
            // Get the input field with the user's name
            var input = card.querySelector('.deck-name');
            var name = input.value.toLowerCase();
            
            // Check if the name contains the search query
            if (name.includes(query)) {
                card.style.display = 'block';  // Show the form if it matches
            } else {
                card.style.display = 'none';   // Hide the form if it doesn't match
            }
        });
    }
</script>
{% endblock %}
{% endblock %}