{% extends 'base.html.twig' %}

{% block title %}Chat{% endblock %}

{% block body %}

<div class="relative flex flex-col items-center justify-center w-full" 
{% if app.user.globalChat is same as true and app.user.modernChat is same as true %}
x-data="chatBox()"
{% endif %}
>
    <!-- Chat Box -->
    <div class="w-[650px] max-h-[80vh] p-6 bg-white shadow-lg rounded-lg mt-10 flex flex-col overflow-hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl text-center text-white bg-red-800 rounded-md px-4 py-2">
                Discussion avec 
                <a href="{{ path('app_profile', {'user': otherUser.id}) }}" class="hover:underline">
                    {{ otherUser.userName }}
                </a>
            </h2>
        </div>

        <div id="messages-container" class="overflow-y-auto flex-1 border border-gray-200 rounded-lg p-4 mb-4">
            {% if messages is defined %}
                {% for message in messages %}
                    <div class="message-container flex w-full {{ message.author.id == app.user.id ? 'justify-end text-end' : 'justify-start' }}">
                        <div class="message-content px-2 rounded-lg max-w-full {{ message.author.id == app.user.id ? 'bg-gray-100' : 'bg-blue-100' }}">
                            <strong class="text-xs text-slate-700">
                                <a class="hover:underline" href="{{ path('app_profile', {'user': message.author.id}) }}">
                                    {{ message.author.username }}:
                                </a>
                            </strong><br>
                            <p class="text-gray-800 rounded-md px-3 py-2 text-sm">{{ message.content }}</p>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="text-gray-500 text-center">Aucun message pour l'instant.</p>
            {% endif %}
        </div>

        {{ form_start(form, {'attr': {'class': 'chat-form flex items-center'}}) }}
            {{ form_widget(form.content, {'attr': {'class': 'border border-gray-300 rounded-lg p-2 flex-1 mr-2'}}) }}
            <input type="hidden" name="otherUserId" id="otherUserId" value="{{ otherUser.id }}">
            <button type="submit" class="bg-white border border-red-800 hover:text-white text-red-800 rounded-lg px-4 py-2 hover:bg-red-800 transition duration-300">Envoyer</button>
        {{ form_end(form) }}
    </div>
</div>


{% if app.user.globalChat is same as false %}
    
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const messagesContainer = document.getElementById('messages-container');
        
        // Scroll to the bottom of the chat box
        if (messagesContainer) {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
    });
    
</script>
{% endif %}

{% endblock %}